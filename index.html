<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>塞尔维亚论坛</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; max-width: 1000px; margin: auto; padding: 20px; background: #f5f5f5; color: #000; transition: background 0.3s, color 0.3s; }
    h1 { text-align: center; }
    .note { color: gray; font-size: 14px; text-align: center; margin-bottom: 20px; }
    .filter { margin: 20px 0; display: flex; gap: 10px; flex-wrap: wrap; justify-content: space-between; align-items: center; }
    input, select { padding: 6px; font-size: 14px; }
    .new-post { background: #2da44e; color: white; border: none; border-radius: 6px; padding: 6px 12px; cursor: pointer; font-size: 14px; }
    .new-post:hover { background: #218838; }
    .posts { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; margin-top: 20px; }
    .card { background: white; border-radius: 8px; padding: 16px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); transition: transform 0.1s, box-shadow 0.3s; }
    .card:hover { transform: translateY(-3px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .card a { font-size: 18px; color: #0366d6; font-weight: bold; text-decoration: none; }
    .card a:hover { text-decoration: underline; }
    .meta { font-size: 12px; color: gray; margin-top: 8px; }
    .pagination { display: flex; justify-content: center; margin-top: 20px; gap: 10px; }
    .pagination button { padding: 6px 12px; font-size: 14px; }
    .pagination span { align-self: center; }
    /* 深色主题 */
    body.dark { background: #121212; color: #e0e0e0; }
    body.dark .card { background: #1e1e1e; box-shadow: 0 2px 6px rgba(255,255,255,0.05); }
    body.dark .card a { color: #58a6ff; }
    body.dark .note, body.dark .meta { color: #aaa; }
    body.dark .new-post { background: #0366d6; }
    body.dark .new-post:hover { background: #0356b6; }
  </style>
</head>
<body>
  <h1>简易论坛</h1>
  <p class="note">帖子数据来自 GitHub Discussions</p>

  <div class="filter">
    <div>
      <input type="text" id="search" placeholder="搜索帖子标题...">
      <select id="category">
        <option value="">所有分类</option>
      </select>
    </div>
    <div>
      <button class="new-post" id="newPostBtn">➕ 发新帖</button>
      <button class="new-post" id="themeToggleBtn">🌙 夜间模式</button>
    </div>
  </div>

  <div class="posts" id="posts">加载中...</div>

  <div class="pagination">
    <button id="prev">上一页</button>
    <span id="page-info">第 1 页</span>
    <button id="next">下一页</button>
  </div>

  <script>
    const username = "serbia70";   // GitHub 用户名
    const repo = "bbs";       // GitHub 仓库名
    const perPage = 10;              // 每页帖子数
    let discussions = [];
    let currentPage = 1;

    const postsContainer = document.getElementById("posts");
    const categorySelect = document.getElementById("category");

    async function loadDiscussions() {
      try {
        const res = await fetch(`https://api.github.com/repos/${username}/${repo}/discussions?per_page=100`);
        if (!res.ok) throw new Error("GitHub API 请求失败");
        discussions = await res.json();

        const categories = [...new Set(discussions.map(d => d.category.name))];
        categories.forEach(cat => {
          const opt = document.createElement("option");
          opt.value = cat;
          opt.textContent = cat;
          categorySelect.appendChild(opt);
        });

        renderPosts();
      } catch (err) {
        postsContainer.innerHTML = "<p>加载失败，请检查 GitHub API 设置。</p>";
      }
    }

    function renderPosts() {
      const keyword = document.getElementById("search").value.toLowerCase();
      const category = document.getElementById("category").value;

      const filtered = discussions
        .filter(d => d.title.toLowerCase().includes(keyword))
        .filter(d => !category || d.category.name === category);

      const totalPages = Math.ceil(filtered.length / perPage);
      if (currentPage > totalPages) currentPage = totalPages || 1;

      const start = (currentPage - 1) * perPage;
      const pageItems = filtered.slice(start, start + perPage);

      postsContainer.innerHTML = "";
      pageItems.forEach(d => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <a href="post.html?title=${encodeURIComponent(d.title)}">${d.title}</a>
          <div class="meta">分类: ${d.category.name} | 作者: ${d.user.login} | 日期: ${new Date(d.created_at).toLocaleDateString()}</div>
        `;
        postsContainer.appendChild(card);
      });

      if (postsContainer.innerHTML === "") postsContainer.innerHTML = "<p>没有找到符合条件的帖子。</p>";

      document.getElementById("page-info").innerText = `第 ${currentPage} 页 / 共 ${totalPages || 1} 页`;
      document.getElementById("prev").disabled = currentPage === 1;
      document.getElementById("next").disabled = currentPage === totalPages || totalPages === 0;
    }

    document.getElementById("search").addEventListener("input", () => { currentPage = 1; renderPosts(); });
    document.getElementById("category").addEventListener("change", () => { currentPage = 1; renderPosts(); });
    document.getElementById("prev").addEventListener("click", () => { if(currentPage>1){currentPage--;renderPosts();}});
    document.getElementById("next").addEventListener("click", () => { currentPage++; renderPosts(); });

    // 发帖按钮
    document.getElementById("newPostBtn").addEventListener("click", () => {
      window.open(`https://github.com/${username}/${repo}/discussions/new`, "_blank");
    });

    // 主题切换
    const themeBtn = document.getElementById("themeToggleBtn");
    if(localStorage.getItem("theme")==="dark"){document.body.classList.add("dark");themeBtn.innerText="☀️ 浅色模式";}
    themeBtn.addEventListener("click",()=>{
      document.body.classList.toggle("dark");
      if(document.body.classList.contains("dark")){
        themeBtn.innerText="☀️ 浅色模式";
        localStorage.setItem("theme","dark");
      }else{
        themeBtn.innerText="🌙 夜间模式";
        localStorage.setItem("theme","light");
      }
    });

    loadDiscussions();
  </script>
</body>

</html>
